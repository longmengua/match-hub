# go-match-hub

## æ’®åˆç³»çµ± - ç³»çµ±æž¶æ§‹åœ–

                   +-----------------+
                   |     Client      |
                   +--------+--------+
                            |
                            v
               +------------+-------------+
               |        Web API Server     |
               +------------+-------------+
                            |
              +-------------+-------------+
              |                           |
         REST API                 WebSocket API
              |                           |
              v                           v
+-------------+--------------+   +--------+----------+
|      Order Controller       |  |   Realtime Stream  |
+----------------------------+   +--------------------+
              |
              v
+-------------+-------------+
|     UseCase (PlaceOrder)  |
+-------------+-------------+
              |
              v
+-------------+--------------+
|         Service Layer       |
+----------------------------+
              |
      +-------+--------+
      |                |
      v                v
+-----+-----+   +------+------+
|  Repo     |   |   MQ Pub    |
| (Postgres)|   | (RabbitMQ)  |
+-----------+   +-------------+

                          |
                          v
              +-----------+-----------+
              |      RabbitMQ Queue   |
              +-----------+-----------+
                          |
                          v
               +----------+----------+
               |     Match Engine    |
               +----------+----------+
                          |
             +------------+-----------+
             |                        |
      +------+-----+         +--------+--------+
      | Redis Cache|         |  Matched Order  |
      | (OrderBook)|         |     Handler     |
      +------------+         +--------+--------+
                                       |
                                       v
                           +-----------+------------+
                           |       gRPC Callback     |
                           |  (to Web API Server)    |
                           +-----------+------------+
                                       |
                              +--------+--------+
                              |   Notify Client   |
                              +-------------------+

## æ’®åˆç³»çµ± - Data Flow Diagram

### Level 0 DFDï¼ˆç³»çµ±ç¸½è¦½ï¼‰

+-----------+        +------------------+       +-------------+
|  Client   +------->+  Web API Server  +------>+ Match Engine|
+-----------+        +------------------+       +-------------+
       ^                     |                         |
       |                     v                         v
       |             +---------------+         +----------------+
       |             |  PostgreSQL   |         |     Redis      |
       |             +---------------+         +----------------+
       |                     |
       |                     v
       |             +----------------+
       |             | RabbitMQ Queue |
       |             +----------------+
       |                     |
       +<--------------------+
        (Notification / Stream)

### Level 1 DFDï¼ˆPlace Order è©³ç´°æµç¨‹ï¼‰

+-----------+
|   Client  |
+-----------+
      |
      v
+-------------------+
|  Place Order API  |
+-------------------+
      |
      v
+-----------------------+
|  Validate & Transform |
+-----------------------+
      |
      v
+---------------------+
|   Save to Database  |
|   (PostgreSQL)      |
+---------------------+
      |
      v
+----------------------+
| Publish to RabbitMQ  |
+----------------------+
      |
      v
+----------------------+
|   Match Engine Sub   |
+----------------------+
      |
      v
+---------------------+
|  Load OrderBook     |
|   (from Redis)      |
+---------------------+
      |
      v
+---------------------+
|   Run Matching Algo |
+---------------------+
      |
      v
+---------------------------+
| Update Redis & Postgres  |
+---------------------------+
      |
      v
+----------------------+
| Push Matched Result  |
| via gRPC to Web API  |
+----------------------+
      |
      v
+------------------+
|  Notify Client   |
+------------------+

## æ’®åˆç³»çµ± - ä»»å‹™åˆ†è§£

### ðŸŒŸ åŠŸèƒ½åˆ†è§£ç¸½è¦½

```
1. APIå±¤ (Go + Gin)
   â”œâ”€â”€ è¨‚å–®æŽ¥æ”¶ (æŽ¥æ”¶HTTPè«‹æ±‚)
   â”œâ”€â”€ è¨‚å–®é©—è­‰ (æ•¸æ“šåˆæ³•æ€§)
   â”œâ”€â”€ è¨‚å–®æŒä¹…åŒ– (PostgreSQLå¯«å…¥)
   â””â”€â”€ è¨‚å–®æŽ¨é€ (ç™¼é€Kafkaäº‹ä»¶)

2. æ’®åˆå¼•æ“Ž (Go + Kafka + Redis)
   â”œâ”€â”€ Kafkaè¨‚å–®æ¶ˆè²» (è¨‚å–®æ‹‰å–)
   â”œâ”€â”€ æ’®åˆé‚è¼¯ (è²·è³£ç›¤åŒ¹é…)
   â”œâ”€â”€ è³‡æ–™çµæ§‹ç®¡ç† (Redis: è·³è¡¨/æœ‰åºé›†åˆ)
   â”œâ”€â”€ æˆäº¤çµæžœè™•ç† (ç”Ÿæˆæˆäº¤äº‹ä»¶)
   â””â”€â”€ æˆäº¤çµæžœæŒä¹…åŒ– (PostgreSQLå¯«å…¥)

3. æ•¸æ“šåŒæ­¥èˆ‡æŒä¹…åŒ– (PostgreSQL)
   â”œâ”€â”€ è¨‚å–®æŒä¹…åŒ– (æœªæˆäº¤è¨‚å–®)
   â”œâ”€â”€ æˆäº¤è¨˜éŒ„æŒä¹…åŒ– (æˆäº¤çµæžœ)
   â”œâ”€â”€ å¿«ç…§ç®¡ç† (å®šæ™‚å¿«ç…§)
   â””â”€â”€ æ•¸æ“šæ¸…ç† (æ­·å²è¨‚å–®æ¸…ç†)

4. é«˜æ€§èƒ½å„ªåŒ–
   â”œâ”€â”€ éžåŒæ­¥è™•ç† (æ¸›å°‘ä¸»ç·šç¨‹é˜»å¡ž)
   â”œâ”€â”€ å¤šç·šç¨‹å„ªåŒ– (æ’®åˆä½µç™¼è™•ç†)
   â”œâ”€â”€ Cacheå±¤å„ªåŒ– (Redisæ“ä½œå„ªåŒ–)
   â””â”€â”€ ç›£æŽ§èˆ‡å¥åº·æª¢æŸ¥ (Prometheus/Grafana)

5. æ¸¬è©¦èˆ‡å£“åŠ›æ¸¬è©¦
   â”œâ”€â”€ å–®å…ƒæ¸¬è©¦ (APIèˆ‡æ’®åˆé‚è¼¯)
   â”œâ”€â”€ æ•´é«”æ¸¬è©¦ (å¾žAPIåˆ°æ’®åˆå®Œæ•´æµç¨‹)
   â”œâ”€â”€ å£“åŠ›æ¸¬è©¦ (å¤§é‡ä¸‹å–®æ¨¡æ“¬)
   â””â”€â”€ æ•…éšœæ¸¬è©¦ (Kafka/Redis/PostgreSQLç•°å¸¸)
```

### ðŸ—‚ï¸ ä»»å‹™æ‹†è§£è©³ç´°èªªæ˜Ž

#### 1. APIå±¤ (Go + Gin)

* **è·è²¬ï¼š** æä¾›HTTPæŽ¥å£ï¼ŒæŽ¥æ”¶è¨‚å–®è«‹æ±‚ã€‚
* **ä»»å‹™åˆ†è§£ï¼š**

  * è¨‚å–®æŽ¥æ”¶ï¼šä½¿ç”¨Ginæ¡†æž¶å»ºç«‹APIï¼ŒæŽ¥æ”¶POSTè«‹æ±‚ã€‚
  * è¨‚å–®é©—è­‰ï¼šæª¢æŸ¥ç”¨æˆ¶IDã€åƒ¹æ ¼ã€æ•¸é‡æ˜¯å¦åˆæ³•ã€‚
  * è¨‚å–®æŒä¹…åŒ–ï¼šå¯«å…¥PostgreSQLï¼Œç•°æ­¥æ“ä½œã€‚
  * è¨‚å–®æŽ¨é€ï¼šå°‡è¨‚å–®è½‰ç‚ºJSONæ ¼å¼æŽ¨é€Kafkaã€‚

#### 2. æ’®åˆå¼•æ“Ž (Go + Kafka + Redis)

* **è·è²¬ï¼š** å¾žKafkaæ‹‰å–è¨‚å–®ï¼Œé€²è¡Œæ’®åˆä¸¦æ›´æ–°Redisã€‚
* **ä»»å‹™åˆ†è§£ï¼š**

  * Kafkaè¨‚å–®æ¶ˆè²»ï¼šè¨‚é–±è¨‚å–®äº‹ä»¶ï¼Œå¾žKafkaè®€å–æ•¸æ“šã€‚
  * æ’®åˆé‚è¼¯ï¼šæ ¹æ“šè²·è³£ç›¤åƒ¹æ ¼åŒ¹é…è¨‚å–®ã€‚
  * è³‡æ–™çµæ§‹ç®¡ç†ï¼šæ›´æ–°Redisæœ‰åºé›†åˆï¼ŒæŒ‰åƒ¹æ ¼æŽ’åºã€‚
  * æˆäº¤çµæžœè™•ç†ï¼šç”Ÿæˆæˆäº¤äº‹ä»¶ï¼ŒæŽ¨é€Kafkaã€‚
  * æˆäº¤çµæžœæŒä¹…åŒ–ï¼šå¯«å…¥PostgreSQLã€‚

#### 3. æ•¸æ“šåŒæ­¥èˆ‡æŒä¹…åŒ– (PostgreSQL)

* **è·è²¬ï¼š** ä¿å­˜è¨‚å–®å’Œæˆäº¤çµæžœï¼Œæ•¸æ“šæŒä¹…åŒ–ã€‚
* **ä»»å‹™åˆ†è§£ï¼š**

  * è¨‚å–®æŒä¹…åŒ–ï¼šå­˜æœªæˆäº¤è¨‚å–®ï¼Œä¿è­‰æ•¸æ“šä¸€è‡´æ€§ã€‚
  * æˆäº¤è¨˜éŒ„æŒä¹…åŒ–ï¼šäº¤æ˜“å®Œæˆå¾Œå¯«å…¥PostgreSQLã€‚
  * å¿«ç…§ç®¡ç†ï¼šå®šæœŸå°‡è¨‚å–®ç°¿å’Œäº¤æ˜“ç‹€æ…‹æŒä¹…åŒ–ã€‚
  * æ•¸æ“šæ¸…ç†ï¼šå®šæœŸåˆªé™¤éŽæœŸè¨‚å–®ã€‚

#### 4. é«˜æ€§èƒ½å„ªåŒ–

* **è·è²¬ï¼š** æå‡ç³»çµ±æ€§èƒ½ï¼Œç¢ºä¿ç©©å®šæ€§ã€‚
* **ä»»å‹™åˆ†è§£ï¼š**

  * éžåŒæ­¥è™•ç†ï¼šæ¸›å°‘é˜»å¡žï¼Œæå‡éŸ¿æ‡‰é€Ÿåº¦ã€‚
  * å¤šç·šç¨‹å„ªåŒ–ï¼šå¤šæ ¸ä½µç™¼ï¼Œæå‡æ’®åˆæ•ˆçŽ‡ã€‚
  * Cacheå±¤å„ªåŒ–ï¼šRedisæ“ä½œæ‰¹é‡è™•ç†ï¼Œé™ä½Žå»¶é²ã€‚
  * å¥åº·ç›£æŽ§ï¼šè¨­ç½®Prometheusç›£æŽ§ï¼Œé˜²æ•…éšœã€‚

#### 5. æ¸¬è©¦èˆ‡å£“åŠ›æ¸¬è©¦

* **è·è²¬ï¼š** ç¢ºä¿ç³»çµ±ç©©å®šæ€§èˆ‡æ€§èƒ½ã€‚
* **ä»»å‹™åˆ†è§£ï¼š**

  * å–®å…ƒæ¸¬è©¦ï¼šé‡å°APIå’Œæ’®åˆæ ¸å¿ƒé€²è¡Œå–®å…ƒæ¸¬è©¦ã€‚
  * æ•´é«”æ¸¬è©¦ï¼šæ¶µè“‹APIå±¤åˆ°æ’®åˆå¼•æ“Žçš„å®Œæ•´æµç¨‹ã€‚
  * å£“åŠ›æ¸¬è©¦ï¼šæ¨¡æ“¬é«˜ä½µç™¼è¨‚å–®æµé‡ã€‚
  * æ•…éšœæ¸¬è©¦ï¼šæ¨¡æ“¬Kafkaã€Redisã€PostgreSQLç•°å¸¸æƒ…æ³ã€‚
